<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: modules/behavior/FlyoutMenu.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: modules/behavior/FlyoutMenu.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

// Required modules.
var BaseTransition = require( '../../modules/transition/BaseTransition' );
var behavior = require( '../../modules/util/behavior' );
var EventObserver = require( '../../modules/util/EventObserver' );
var fnBind = require( '../../modules/util/fn-bind' ).fnBind;
var standardType = require( '../../modules/util/standard-type' );

/**
 * FlyoutMenu
 * @class
 *
 * @classdesc Initializes new FlyoutMenu behavior.
 * Behaviors are functionality that can be shared between different pieces
 * of markup. They are not strictly atomic, though they likely are used
 * on atomic components.
 * As added JS behavior, this is added through HTML data-js-hook attributes.
 *
 * Structure is:
 * behavior_flyout-menu
 *   behavior_flyout-menu_trigger
 *   behavior_flyout-menu_content
 *     behavior_flyout-menu_alt-trigger
 *
 * The alt-trigger is for a back button, which may obscure the first trigger.
 * The flyout can be triggered three ways: through a click of the trigger or
 * through the click of an alt-trigger.
 *
 * @param {HTMLNode} element - The DOM element to attach FlyoutMenu behavior.
 * @returns {FlyoutMenu} An instance.
 */
function FlyoutMenu( element ) { // eslint-disable-line max-statements, no-inline-comments, max-len

  var BASE_CLASS = standardType.BEHAVIOR_PREFIX + 'flyout-menu';
  var SEL_PREFIX = '[' + standardType.JS_HOOK + '=' + BASE_CLASS;
  var BASE_SEL = SEL_PREFIX + ']';

  // Verify that the expected dom attributes are present.
  var _dom = behavior.checkBehaviorDom( element, BASE_CLASS );
  var _triggerDom = behavior.checkBehaviorDom( element, BASE_CLASS + '_trigger' );
  var _contentDom = behavior.checkBehaviorDom( element, BASE_CLASS + '_content' );

  var _altTriggerDom = _dom.querySelector( SEL_PREFIX + '_alt-trigger]' );

  var _isExpanded = false;
  var _isAnimating = false;

  var _expandTransition;
  var _expandTransitionMethod;
  var _expandTransitionMethodArgs = [];

  var _collapseTransition;
  var _collapseTransitionMethod;
  var _collapseTransitionMethodArgs = [];

  // Binded events.
  var _collapseBinded = fnBind( collapse, this );
  // Needed to add and remove events to transitions.
  var _collapseEndBinded = fnBind( _collapseEnd, this );
  var _expandEndBinded = fnBind( _expandEnd, this );

  // If this menu appears in a data source,
  // this can be used to store the source.
  // Examples include the index in an Array,
  // a key in an Hash, or a node in a Tree.
  var _data;

  // Set this function to a queued collapse function,
  // which is called if collapse is called while
  // expand is animating.
  var _deferFunct = standardType.noopFunct;

  // Whether this instance's behaviors are suspended or not.
  var _suspended = true;

  // Event immediately preceeding mouseover is touchstart,
  // if that event's present we'll want to ignore mouseover
  // to avoid a mouseover and click immediately after each other.
  var _touchTriggered = false;

  // TODO: Add param to set the FlyoutMenu open at initialization-time.
  /**
   * @returns {FlyoutMenu} An instance.
   */
  function init() {
    // Ignore Google Analytics on the trigger if it is a link,
    // since we're preventing the default link behavior.
    if ( _triggerDom.tagName === 'A' ) {
      _triggerDom.setAttribute( 'data-gtm_ignore', 'true' );
    }

    var handleTriggerClickedBinded = fnBind( _handleTriggerClicked, this );
    var handleTriggerOverBinded = fnBind( _handleTriggerOver, this );
    var handleTriggerOutBinded = fnBind( _handleTriggerOut, this );

    // Set initial aria attributes to false.
    _setAriaAttr( 'expanded', _triggerDom, 'false' );
    _setAriaAttr( 'pressed', _triggerDom, 'false' );

    _triggerDom.addEventListener( 'click', handleTriggerClickedBinded );
    _triggerDom.addEventListener( 'touchstart', _handleTouchStart );
    _triggerDom.addEventListener( 'mouseover', handleTriggerOverBinded );
    _triggerDom.addEventListener( 'mouseout', handleTriggerOutBinded );

    if ( _altTriggerDom ) {
      // If menu contains a submenu but doesn't have
      // its own alternative trigger (such as a Back button),
      // then the altTriggerDom may be in the submenu and we
      // need to remove the reference.
      var subMenu = _dom.querySelector( BASE_SEL );
      if ( subMenu &amp;&amp; subMenu.contains( _altTriggerDom ) ) {
        _altTriggerDom = null;
      } else {
        // TODO: Investigate just having multiple triggers,
        //       instead of a primary and alternative.
        // Ignore Google Analytics on the trigger if it is a link,
        // since we're preventing the default link behavior.
        if ( _altTriggerDom.tagName === 'A' ) {
          _altTriggerDom.setAttribute( 'data-gtm_ignore', 'true' );
        }

        // Set initial aria attributes to false.
        _setAriaAttr( 'expanded', _altTriggerDom, 'false' );

        // TODO: alt trigger should probably listen
        //       for a mouseover/mouseout event too.
        _altTriggerDom.addEventListener( 'click', handleTriggerClickedBinded );
      }
    }

    resume();

    return this;
  }

  /**
   * Set an aria attribute on an HTML element.
   * @param {string} type - The aria attribute to set
   *   (without the aria- prefix).
   * @param {HTMLNode} elem - The element to set.
   * @param {boolean} value - The value to set on `aria-expanded`,
   *   casts to a string.
   * @returns {string} The cast value.
   */
  function _setAriaAttr( type, elem, value ) {
    var strValue = String( value );
    elem.setAttribute( 'aria-' + type, strValue );
    return strValue;
  }

  /**
   * Event handler for when the search input trigger is touched.
   */
  function _handleTouchStart() {
    _touchTriggered = true;
  }

  /**
   * Event handler for when the trigger is hovered over.
   */
  function _handleTriggerOver() {
    if ( !_touchTriggered &amp;&amp; !_suspended ) {
      this.dispatchEvent( 'triggerOver',
                          { target: this, type: 'triggerOver' } );
    }
    _touchTriggered = false;
  }

  /**
   * Event handler for when the trigger is hovered out.
   */
  function _handleTriggerOut() {
    if ( !_suspended ) {
      this.dispatchEvent( 'triggerOut',
                          { target: this, type: 'triggerOut' } );
    }
  }

  /**
   * Event handler for when the search input trigger is clicked,
   * which opens/closes the search input.
   * @param {MouseEvent} event - The flyout trigger was clicked.
   */
  function _handleTriggerClicked( event ) {
    if ( !_suspended ) {
      this.dispatchEvent( 'triggerClick',
                          { target: this, type: 'triggerClick' } );
      event.preventDefault();
      if ( _isExpanded ) {
        this.collapse();
      } else {
        this.expand();
      }
    }
  }

  /**
   * Open the search box.
   * @returns {FlyoutMenu} An instance.
   */
  function expand() {
    if ( !_isExpanded &amp;&amp; !_isAnimating ) {
      _isAnimating = true;
      _deferFunct = standardType.noopFunct;
      this.dispatchEvent( 'expandBegin',
                          { target: this, type: 'expandBegin' } );
      _setAriaAttr( 'pressed', _triggerDom, true );
      if ( _expandTransitionMethod ) {
        var hasTransition = _expandTransition &amp;&amp;
                            _expandTransition.isAnimated();
        if ( hasTransition ) {
          _expandTransition
            .addEventListener( BaseTransition.END_EVENT, _expandEndBinded );
        }
        _expandTransitionMethod
          .apply( _expandTransition, _expandTransitionMethodArgs );
        if ( !hasTransition ) {
          _expandEndBinded();
        }
      } else {
        _expandEndBinded();
      }
    }

    return this;
  }

  /**
   * Close the search box.
   * If collapse is called when expand animation is underway,
   * save a deferred call to collapse, which is called when
   * expand completes.
   * @returns {FlyoutMenu} An instance.
   */
  function collapse() {
    if ( _isExpanded &amp;&amp; !_isAnimating ) {
      _deferFunct = standardType.noopFunct;
      _isAnimating = true;
      _isExpanded = false;
      this.dispatchEvent( 'collapseBegin',
                          { target: this, type: 'collapseBegin' } );
      if ( _collapseTransitionMethod ) {
        var hasTransition = _collapseTransition &amp;&amp;
                            _collapseTransition.isAnimated();
        if ( hasTransition ) {
          _collapseTransition
            .addEventListener( BaseTransition.END_EVENT, _collapseEndBinded );
        }
        _collapseTransitionMethod
          .apply( _collapseTransition, _collapseTransitionMethodArgs );
        if ( !hasTransition ) {
          _collapseEndBinded();
        }
      } else {
        _collapseEndBinded();
      }

      if ( _altTriggerDom ) {
        _setAriaAttr( 'expanded', _altTriggerDom, false );
      }

      _setAriaAttr( 'expanded', _triggerDom, false );
      _setAriaAttr( 'pressed', _triggerDom, false );
      _setAriaAttr( 'expanded', _contentDom, false );
      // TODO: Remove or uncomment when keyboard navigation is in.
      // _triggerDom.focus();
    } else {
      _deferFunct = _collapseBinded;
    }

    return this;
  }

  /**
   * Expand animation has completed.
   * Call deferred collapse function,
   * if set (otherwise it will call a noop function).
   */
  function _expandEnd() {
    _isAnimating = false;
    _isExpanded = true;
    if ( _expandTransition ) {
      _expandTransition
        .removeEventListener( BaseTransition.END_EVENT, _expandEndBinded );
    }
    this.dispatchEvent( 'expandEnd', { target: this, type: 'expandEnd' } );
    if ( _altTriggerDom ) {
      _setAriaAttr( 'expanded', _altTriggerDom, true );
    }
    _setAriaAttr( 'expanded', _triggerDom, true );
    _setAriaAttr( 'expanded', _contentDom, true );
    // Call collapse, if it was called while expand was animating.
    _deferFunct();
  }

  /**
   * Collapse animation has completed.
   */
  function _collapseEnd() {
    _isAnimating = false;
    if ( _collapseTransition ) {
      _collapseTransition
        .removeEventListener( BaseTransition.END_EVENT, _collapseEndBinded );
    }
    this.dispatchEvent( 'collapseEnd', { target: this, type: 'collapseEnd' } );
  }

  /**
   * @param {MoveTransition|AlphaTransition} transition
   *   A transition instance to watch for events on.
   * @param {Function} method
   *   The transition method to call on expand.
   * @param {Array} [args]
   *   List of arguments to apply to collapse method.
   */
  function setExpandTransition( transition, method, args ) {
    _expandTransition = transition;
    _expandTransitionMethod = method;
    _expandTransitionMethodArgs = args;
  }

  /**
   * @param {MoveTransition|AlphaTransition} transition
   *   A transition instance to watch for events on.
   * @param {Function} method
   *   The transition method to call on collapse.
   * @param {Array} [args]
   *   List of arguments to apply to collapse method.
   */
  function setCollapseTransition( transition, method, args ) {
    _collapseTransition = transition;
    _collapseTransitionMethod = method;
    _collapseTransitionMethodArgs = args;
  }

  /**
   * Clear the transitions attached to this FlyoutMenu instance.
   */
  function clearTransitions() {
    var transition = getTransition( FlyoutMenu.EXPAND_TYPE );
    if ( transition ) { transition.remove(); }
    transition = getTransition( FlyoutMenu.COLLAPSE_TYPE );
    if ( transition ) { transition.remove(); }

    _expandTransition = standardType.UNDEFINED;
    _expandTransitionMethod = standardType.UNDEFINED;
    _expandTransitionMethodArgs = [];

    _collapseTransition = standardType.UNDEFINED;
    _collapseTransitionMethod = standardType.UNDEFINED;
    _collapseTransitionMethodArgs = [];
  }

  /**
   * @param {string} [type]
   *   The type of transition to return.
   *   Accepts 'expand' or 'collapse'.
   *   `FlyoutMenu.EXPAND_TYPE` and `FlyoutMenu.COLLAPSE_TYPE` can be used
   *   as type-safe constants passed into this method.
   *   If neither or something else is supplied, expand type is returned.
   * @returns {MoveTransition|AlphaTransition|undefined}
   *   A transition instance set on this instance, or undefined if none is set.
   */
  function getTransition( type ) {
    if ( type === FlyoutMenu.COLLAPSE_TYPE ) {
      return _collapseTransition;
    }

    return _expandTransition;
  }

  /**
   * @returns {Object}
   *   Hash of trigger, alternative trigger, and content DOM references.
   */
  function getDom() {
    return {
      altTrigger: _altTriggerDom,
      container:  _dom,
      content:    _contentDom,
      trigger:    _triggerDom
    };
  }

  /**
   * Enable broadcasting of trigger events.
   * @returns {boolean} True if resumed, false otherwise.
   */
  function resume() {
    if ( _suspended ) {
      _suspended = false;
    }

    return !_suspended;
  }

  /**
   * Suspend broadcasting of trigger events.
   * @returns {boolean} True if suspended, false otherwise.
   */
  function suspend() {
    if ( !_suspended ) {
      _suspended = true;
    }

    return _suspended;
  }

  // TODO: Use Object.defineProperty to create a getter/setter.
  //       See https://github.com/cfpb/cfgov-refresh/pull/1566/
  //           files#diff-7a844d22219d7d3db1fa7c1e70d7ba45R35
  /**
   * @returns {number|string|Object} A data identifier such as an Array index,
   *   Hash key, or Tree node.
   */
  function getData() {
    return _data;
  }

  /**
   * @param {number|string|Object} data
   *   A data identifier such as an Array index, Hash key, or Tree node.
   * @returns {FlyoutMenu} An instance.
   */
  function setData( data ) {
    _data = data;

    return this;
  }

  /**
   * @returns {boolean} True if menu is animating, false otherwise.
   */
  function isAnimating() {
    return _isAnimating;
  }

  /**
   * @returns {boolean} True if menu is expanded, false otherwise.
   */
  function isExpanded() {
    return _isExpanded;
  }

  // Attach public events.
  var eventObserver = new EventObserver();
  this.addEventListener = eventObserver.addEventListener;
  this.removeEventListener = eventObserver.removeEventListener;
  this.dispatchEvent = eventObserver.dispatchEvent;

  this.init = init;
  this.expand = expand;
  this.collapse = collapse;
  this.setExpandTransition = setExpandTransition;
  this.setCollapseTransition = setCollapseTransition;
  this.clearTransitions = clearTransitions;
  this.getData = getData;
  this.getTransition = getTransition;
  this.getDom = getDom;
  this.isAnimating = isAnimating;
  this.isExpanded = isExpanded;
  this.resume = resume;
  this.setData = setData;
  this.suspend = suspend;

  // Public static properties.
  FlyoutMenu.EXPAND_TYPE = 'expand';
  FlyoutMenu.COLLAPSE_TYPE = 'collapse';
  FlyoutMenu.BASE_CLASS = BASE_CLASS;

  return this;
}

module.exports = FlyoutMenu;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AlphaTransition.html">AlphaTransition</a></li><li><a href="BaseTransition.html">BaseTransition</a></li><li><a href="BreakpointHandler.html">BreakpointHandler</a></li><li><a href="ClearableInput.html">ClearableInput</a></li><li><a href="ContentSlider.html">ContentSlider</a></li><li><a href="EventObserver.html">EventObserver</a></li><li><a href="Expandable.html">Expandable</a></li><li><a href="ExpandableGroup.html">ExpandableGroup</a></li><li><a href="ExternalSite.html">ExternalSite</a></li><li><a href="FilterableListControls.html">FilterableListControls</a></li><li><a href="FlyoutMenu.html">FlyoutMenu</a></li><li><a href="Footer.html">Footer</a></li><li><a href="GlobalBanner.html">GlobalBanner</a></li><li><a href="GlobalSearch.html">GlobalSearch</a></li><li><a href="Header.html">Header</a></li><li><a href="MegaMenu.html">MegaMenu</a></li><li><a href="MegaMenuDesktop.html">MegaMenuDesktop</a></li><li><a href="MegaMenuMobile.html">MegaMenuMobile</a></li><li><a href="MobileCarousel.html">MobileCarousel</a></li><li><a href="MoveTransition.html">MoveTransition</a></li><li><a href="Multiselect.html">Multiselect</a></li><li><a href="Notification.html">Notification</a></li><li><a href="SecondaryNavigation.html">SecondaryNavigation</a></li><li><a href="Tree.html">Tree</a></li><li><a href="TreeNode.html">TreeNode</a></li><li><a href="UStreamPlayer.html">UStreamPlayer</a></li><li><a href="VideoPlayer.html">VideoPlayer</a></li><li><a href="YoutubePlayer.html">YoutubePlayer</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_attachIFrame">_attachIFrame</a></li><li><a href="global.html#_calculateCollapseDuration">_calculateCollapseDuration</a></li><li><a href="global.html#_calculateExpandDuration">_calculateExpandDuration</a></li><li><a href="global.html#_checkableInput">_checkableInput</a></li><li><a href="global.html#_clearError">_clearError</a></li><li><a href="global.html#_constrainValue">_constrainValue</a></li><li><a href="global.html#_createElement">_createElement</a></li><li><a href="global.html#_createMessage">_createMessage</a></li><li><a href="global.html#_ensureElement">_ensureElement</a></li><li><a href="global.html#_findElements">_findElements</a></li><li><a href="global.html#_getMatchesMethod">_getMatchesMethod</a></li><li><a href="global.html#_getStorageType">_getStorageType</a></li><li><a href="global.html#_getTransitionEndEvent">_getTransitionEndEvent</a></li><li><a href="global.html#_getTransitionPrefix">_getTransitionPrefix</a></li><li><a href="global.html#_inBreakpointRange">_inBreakpointRange</a></li><li><a href="global.html#_init">_init</a></li><li><a href="global.html#_initEvents">_initEvents</a></li><li><a href="global.html#_isPlainObject">_isPlainObject</a></li><li><a href="global.html#_navSecondaryToggle">_navSecondaryToggle</a></li><li><a href="global.html#_navSecondaryToggleTest">_navSecondaryToggleTest</a></li><li><a href="global.html#_onAction">_onAction</a></li><li><a href="global.html#_scrollToTop">_scrollToTop</a></li><li><a href="global.html#_sendError">_sendError</a></li><li><a href="global.html#_sendSubscriptionRequest">_sendSubscriptionRequest</a></li><li><a href="global.html#_setChildElements">_setChildElements</a></li><li><a href="global.html#_tableClicked">_tableClicked</a></li><li><a href="global.html#_toCamelCase">_toCamelCase</a></li><li><a href="global.html#_verifyClassExists">_verifyClassExists</a></li><li><a href="global.html#_verifyElementExists">_verifyElementExists</a></li><li><a href="global.html#add">add</a></li><li><a href="global.html#assign">assign</a></li><li><a href="global.html#attach">attach</a></li><li><a href="global.html#backtrack">backtrack</a></li><li><a href="global.html#BEHAVIOR_PREFIX">BEHAVIOR_PREFIX</a></li><li><a href="global.html#bfs">bfs</a></li><li><a href="global.html#bindEvent">bindEvent</a></li><li><a href="global.html#checkBehaviorDom">checkBehaviorDom</a></li><li><a href="global.html#checkbox">checkbox</a></li><li><a href="global.html#checkDom">checkDom</a></li><li><a href="global.html#closest">closest</a></li><li><a href="global.html#contains">contains</a></li><li><a href="global.html#create">create</a></li><li><a href="global.html#dataSet">dataSet</a></li><li><a href="global.html#date">date</a></li><li><a href="global.html#destroyInitFlag">destroyInitFlag</a></li><li><a href="global.html#dfs">dfs</a></li><li><a href="global.html#email">email</a></li><li><a href="global.html#empty">empty</a></li><li><a href="global.html#find">find</a></li><li><a href="global.html#get">get</a></li><li><a href="global.html#getItem">getItem</a></li><li><a href="global.html#getSiblings">getSiblings</a></li><li><a href="global.html#getViewportDimensions">getViewportDimensions</a></li><li><a href="global.html#handleViewportChange">handleViewportChange</a></li><li><a href="global.html#indexOfObject">indexOfObject</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#INIT_FLAG">INIT_FLAG</a></li><li><a href="global.html#instantiateAll">instantiateAll</a></li><li><a href="global.html#isArray">isArray</a></li><li><a href="global.html#isDate">isDate</a></li><li><a href="global.html#isDefined">isDefined</a></li><li><a href="global.html#isEmpty">isEmpty</a></li><li><a href="global.html#isFunction">isFunction</a></li><li><a href="global.html#isInDesktop">isInDesktop</a></li><li><a href="global.html#isNumber">isNumber</a></li><li><a href="global.html#isObject">isObject</a></li><li><a href="global.html#isOneExpanded">isOneExpanded</a></li><li><a href="global.html#isString">isString</a></li><li><a href="global.html#isThisExpanded">isThisExpanded</a></li><li><a href="global.html#isUndefined">isUndefined</a></li><li><a href="global.html#JS_HOOK">JS_HOOK</a></li><li><a href="global.html#loadScript">loadScript</a></li><li><a href="global.html#noopFunct">noopFunct</a></li><li><a href="global.html#not">not</a></li><li><a href="global.html#queryOne">queryOne</a></li><li><a href="global.html#radio">radio</a></li><li><a href="global.html#remove">remove</a></li><li><a href="global.html#removeItem">removeItem</a></li><li><a href="global.html#sendEvent">sendEvent</a></li><li><a href="global.html#sendEvents">sendEvents</a></li><li><a href="global.html#setInitFlag">setInitFlag</a></li><li><a href="global.html#setItem">setItem</a></li><li><a href="global.html#setStorage">setStorage</a></li><li><a href="global.html#STATE_PREFIX">STATE_PREFIX</a></li><li><a href="global.html#stringEscape">stringEscape</a></li><li><a href="global.html#stringMatch">stringMatch</a></li><li><a href="global.html#stringValid">stringValid</a></li><li><a href="global.html#testBreakpoint">testBreakpoint</a></li><li><a href="global.html#toggleExpandedState">toggleExpandedState</a></li><li><a href="global.html#watchWindowResize">watchWindowResize</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.2</a> on Wed Nov 02 2016 08:33:37 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
